# 输入系统模式切换指南

## 🎯 问题解决

### 问题
拉伸系统与角色移动使用相同键位（WASD），导致：
- 按 W 键 → 角色前进 + 拉伸预览（同时触发）
- 无法精确控制拉伸方向

### 解决方案：自动模式切换 ✅

通过**自动模式切换**实现：
- **移动模式**（默认）：WASD 控制角色移动
- **拉伸模式**（选中 Cube）：WASD 控制拉伸方向，角色移动自动禁用

---

## 🚀 快速设置（1分钟）

### 步骤1: 配置 ExtendInputManager

1. **Hierarchy** → 找到 `ExtendInputManager` GameObject
2. **Inspector** → `Extend Input Manager` 组件
3. **拖入 Player** 到 `Player Controller` 字段
   ```
   Player Controller: [拖入场景中的 Player GameObject]
   Auto Disable Movement: ✓（已勾选）
   ```

### 步骤2: 测试

1. **Play** ▶️
2. **WASD 移动角色**（移动模式）
3. **左键点击 Cube**（自动切换到拉伸模式）
4. **WASD 拉伸**（角色不移动）
5. **ESC 取消选择**（回到移动模式）

---

## 🎮 操作流程

### 完整流程

```
【移动模式】默认状态
  ├─ WASD → 角色移动 ✅
  ├─ 鼠标视角 ✅
  └─ 左键点击 Cube
      ↓
【拉伸模式】自动切换
  ├─ 角色移动禁用 🚫
  ├─ WASD + QE → 拉伸控制 ✅
  ├─ 鼠标视角依然可用 ✅
  └─ ESC / 右键
      ↓
【移动模式】自动恢复
  └─ WASD → 角色移动 ✅
```

### 视觉指示

左上角 GUI 显示当前模式：
- **【移动模式】**（绿色）：可以移动角色
- **【拉伸模式】**（青色）：可以拉伸 Cube

---

## 📋 键位对照表

### 移动模式

| 按键 | 功能 |
|------|------|
| **WASD** | 角色移动 |
| **鼠标** | 视角控制 |
| **左键** | 选中 Cube（切换到拉伸模式） |
| **空格** | 跳跃（如果实现） |

### 拉伸模式

| 按键 | 功能 |
|------|------|
| **WASD** | 拉伸方向（前后左右）|
| **Q / E** | 拉伸方向（下/上） |
| **鼠标** | 视角控制（依然可用）|
| **ESC** | 退出拉伸模式 |
| **右键** | 退出拉伸模式（备用）|

---

## ⚙️ 配置选项

### ExtendInputManager 配置

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `Hold Threshold` | float | 0.1s | 按住多久开始预览 |
| `Extend Interval` | float | 0.2s | 延长预览的间隔 |
| `Max Extend Length` | int | 10 | 最大拉伸长度 |
| **Player Controller** | FirstPersonController | - | **玩家控制器（必须设置）** |
| **Auto Disable Movement** | bool | true | **自动禁用移动（推荐）** |
| `Show Debug Log` | bool | true | 显示调试日志 |

### 重要参数说明

#### Player Controller
- **作用**：拉伸模式时自动禁用角色移动
- **设置方法**：拖入场景中的 Player GameObject
- **验证**：Player 必须有 `FirstPersonController` 组件

#### Auto Disable Movement
- **启用**（推荐）：选中 Cube 时自动禁用移动
- **禁用**：移动和拉伸同时响应（不推荐，会冲突）

---

## 🔄 工作原理

### 模式切换逻辑

```csharp
Update()
{
    bool isInExtendMode = (选中 Cube);
    
    if (isInExtendMode && !wasInExtendMode)
    {
        // 进入拉伸模式
        playerController.enabled = false;
        Debug.Log("[拉伸模式] 角色移动已禁用");
    }
    else if (!isInExtendMode && wasInExtendMode)
    {
        // 退出拉伸模式
        playerController.enabled = true;
        Debug.Log("[移动模式] 角色移动已启用");
    }
}
```

### FirstPersonController 状态

| 状态 | enabled | 效果 |
|------|---------|------|
| **移动模式** | ✅ true | WASD 控制移动 |
| **拉伸模式** | ❌ false | WASD 被忽略 |

---

## 🎨 用户体验

### 优点

1. ✅ **无需记忆额外键位**（WASD 复用）
2. ✅ **自动切换，无需手动操作**
3. ✅ **清晰的视觉反馈**（GUI 显示模式）
4. ✅ **直观的操作流程**（点击进入，ESC 退出）
5. ✅ **鼠标视角始终可用**

### 设计考虑

**为什么选中后禁用移动？**
- 拉伸需要精确对准方向
- 避免误操作（拉伸时不小心移动）
- 聚焦单一任务（先拉伸，后移动）

**为什么不用 Shift 切换？**
- 需要两只手操作（不便）
- 容易忘记按 Shift
- 自动模式更自然

---

## 🐛 故障排查

### 问题1: 选中 Cube 后角色依然移动

**原因**：
- `Player Controller` 未设置
- `Auto Disable Movement` 未勾选

**解决**：
1. 检查 `ExtendInputManager` 的 `Player Controller` 字段
2. 拖入场景中的 Player GameObject
3. 确认 `Auto Disable Movement` = ✓

### 问题2: 按 ESC 没反应

**原因**：
- `CubeSelectionManager` 未更新

**解决**：
1. 确认文件已保存并重新编译
2. 检查 Console 是否有错误
3. 尝试右键取消选择（备用）

### 问题3: 模式切换不显示

**原因**：
- `Show Debug Log` 未勾选
- GUI 被遮挡

**解决**：
1. `ExtendInputManager` → `Show Debug Log` = ✓
2. 查看 Game 窗口左上角
3. 检查 Console 日志（有切换提示）

### 问题4: FirstPersonController 报错

**原因**：
- Player 对象没有 `FirstPersonController` 组件
- 脚本命名空间不匹配

**解决**：
1. 确认 Player 有 `FirstPersonController` 组件
2. 检查脚本是否在正确的命名空间
3. 如果使用自定义控制器，修改 `ExtendInputManager` 的引用类型

---

## 📊 Console 日志说明

### 正常日志

| 日志 | 含义 |
|------|------|
| `[拉伸模式] 角色移动已禁用` | 选中 Cube，进入拉伸模式 |
| `[移动模式] 角色移动已启用` | 取消选择，回到移动模式 |
| `开始预览: 方向=(0,0,1), 长度=1` | 开始拉伸预览 |
| `确认拉伸: 方向=(0,0,1), 长度=5` | 松开键，确认拉伸 |
| `成功拉伸 5 个 Cube` | 拉伸完成 |

### 错误日志

| 日志 | 含义 | 解决方法 |
|------|------|----------|
| `Player Controller 未设置` | 缺少引用 | 拖入 Player 到 `Player Controller` 字段 |

---

## 🔮 未来扩展

### 计划功能

1. **Shift 强制拉伸模式**
   - 按住 Shift：即使未选中也能拉伸
   - 用于快速拉伸多个 Cube

2. **自定义键位**
   - 支持重新绑定拉伸键位
   - 保存用户偏好

3. **多模式支持**
   - 拉伸模式
   - 旋转模式
   - 形状转换模式

4. **输入提示 UI**
   - 屏幕中央显示当前可用操作
   - 动态更新提示内容

---

## 📚 相关文档

- [Cube拉伸系统使用指南.md](./Cube拉伸系统使用指南.md)
- [拉伸系统快速开始.md](./拉伸系统快速开始.md)
- [拉伸系统技术架构.md](./拉伸系统技术架构.md)
- [Cube选择系统使用指南.md](./Cube选择系统使用指南.md)

---

## 💡 设计理念

### 用户中心设计

1. **最小化学习成本**
   - 复用熟悉的 WASD 键位
   - 自动模式切换，无需记忆

2. **清晰的反馈**
   - GUI 显示当前模式
   - Console 日志记录切换

3. **容错设计**
   - ESC 和右键都能退出
   - 误操作后容易恢复

4. **渐进式复杂度**
   - 基础功能简单易用
   - 高级功能逐步解锁

---

## ✅ 验证清单

使用前确认：

- [ ] ExtendInputManager 已添加到场景
- [ ] Player Controller 已设置
- [ ] Auto Disable Movement 已勾选
- [ ] CubeSelectionManager 已添加到场景
- [ ] Play 模式无编译错误
- [ ] 移动模式：WASD 可以移动角色
- [ ] 点击 Cube：GUI 显示"拉伸模式"
- [ ] 拉伸模式：WASD 拉伸，角色不移动
- [ ] 按 ESC：GUI 显示"移动模式"，恢复移动

---

**🎉 享受流畅的输入体验！**

