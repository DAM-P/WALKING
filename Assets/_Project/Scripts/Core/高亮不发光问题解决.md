# ğŸ”¥ é«˜äº®ä¸å‘å…‰é—®é¢˜è§£å†³

## å·²ä¿®å¤çš„ä»£ç 

âœ… **`HighlightRenderSystem.cs`** - æ·»åŠ äº†æè´¨å†™å…¥é€»è¾‘  
âœ… **`CubeLayoutSpawnSystem.cs`** - ä¸ºå¯äº¤äº’ Cube æ·»åŠ  Emission ç»„ä»¶

---

## ğŸš¨ å¿…é¡»æ£€æŸ¥çš„é…ç½®

### 1ï¸âƒ£ å®šä¹‰ `HAS_URP_MATERIAL_PROPERTY` å®

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. `Edit > Project Settings > Player`
2. åˆ‡æ¢åˆ° `Other Settings` é¢æ¿
3. æ‰¾åˆ° `Scripting Define Symbols`
4. æ£€æŸ¥æ˜¯å¦æœ‰ **`HAS_URP_MATERIAL_PROPERTY`**

**å¦‚æœæ²¡æœ‰**ï¼š
- ç‚¹å‡»è¾“å…¥æ¡†ï¼Œæ·»åŠ  `HAS_URP_MATERIAL_PROPERTY`
- æŒ‰ `Enter` æˆ–ç‚¹å‡» `Apply`
- ç­‰å¾… Unity é‡æ–°ç¼–è¯‘ï¼ˆå¿…é¡»ï¼ï¼‰

**é‡è¦**ï¼šæ²¡æœ‰è¿™ä¸ªå®ï¼Œæ‰€æœ‰é«˜äº®ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œï¼

---

### 2ï¸âƒ£ æ£€æŸ¥ Cube æè´¨æ˜¯å¦æ”¯æŒ Emission

**æ­¥éª¤**ï¼š
1. æ‰¾åˆ°ä½ çš„ **Cube Prefab**
2. é€‰ä¸­ Prefabï¼ŒæŸ¥çœ‹ Inspector
3. æ‰¾åˆ° `Mesh Renderer > Materials`
4. ç‚¹å‡» Material

**æ£€æŸ¥æè´¨**ï¼š
- Shader å¿…é¡»æ”¯æŒ Emissionï¼ˆå¦‚ `Universal Render Pipeline/Lit`ï¼‰
- Inspector ä¸­åº”è¯¥æœ‰ **`Emission`** åŒºå—
- å¦‚æœæ²¡æœ‰ï¼Œåˆ‡æ¢ Shaderï¼š
  - Shader ä¸‹æ‹‰èœå•
  - é€‰æ‹© `Universal Render Pipeline > Lit`
  - å‹¾é€‰ `Emission` å¤é€‰æ¡†

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•å®æ˜¯å¦ç”Ÿæ•ˆ

åœ¨ **ä»»æ„è„šæœ¬** ä¸­æ·»åŠ ï¼š
```csharp
void Start()
{
#if HAS_URP_MATERIAL_PROPERTY
    Debug.Log("âœ… HAS_URP_MATERIAL_PROPERTY å·²å®šä¹‰");
#else
    Debug.LogError("âŒ HAS_URP_MATERIAL_PROPERTY æœªå®šä¹‰ï¼è¯·åœ¨ Project Settings > Player > Scripting Define Symbols ä¸­æ·»åŠ ");
#endif
}
```

**è¿è¡Œ Play**ï¼š
- çœ‹åˆ° `âœ…` â†’ å®æ­£å¸¸
- çœ‹åˆ° `âŒ` â†’ å¿…é¡»æ·»åŠ å®

---

### æµ‹è¯• Emission ç»„ä»¶

**ä¸´æ—¶è°ƒè¯•ä»£ç **ï¼ˆæ·»åŠ åˆ° `CubeSelectionManager.SelectCube` æ–¹æ³•æœ«å°¾ï¼‰ï¼š

```csharp
// æ£€æŸ¥ Entity æ˜¯å¦æœ‰ Emission ç»„ä»¶
#if HAS_URP_MATERIAL_PROPERTY
if (_entityManager.HasComponent<Unity.Rendering.URPMaterialPropertyEmissionColor>(entity))
{
    Debug.Log("âœ… Entity æœ‰ Emission ç»„ä»¶");
    var emission = _entityManager.GetComponentData<Unity.Rendering.URPMaterialPropertyEmissionColor>(entity);
    Debug.Log($"Emission å€¼: {emission.Value}");
}
else
{
    Debug.LogError("âŒ Entity ç¼ºå°‘ Emission ç»„ä»¶ï¼");
}
#else
Debug.LogError("âŒ HAS_URP_MATERIAL_PROPERTY æœªå®šä¹‰ï¼");
#endif
```

**ç‚¹å‡»æ–¹å—å Console åº”æ˜¾ç¤º**ï¼š
```
âœ… Entity æœ‰ Emission ç»„ä»¶
Emission å€¼: (0, 0, 0, 0)
```

---

## ğŸ› ï¸ å®Œæ•´è§£å†³æµç¨‹

### æ­¥éª¤1ï¼šæ·»åŠ å®å®šä¹‰
1. Project Settings > Player > Scripting Define Symbols
2. æ·»åŠ  `HAS_URP_MATERIAL_PROPERTY`
3. **ç­‰å¾…ç¼–è¯‘å®Œæˆ**ï¼ˆå³ä¸‹è§’è½¬åœˆæ¶ˆå¤±ï¼‰

### æ­¥éª¤2ï¼šé…ç½® Cube æè´¨
1. é€‰ä¸­ Cube Prefab
2. Material Shader â†’ `URP/Lit`
3. å‹¾é€‰ `Emission` å¤é€‰æ¡†

### æ­¥éª¤3ï¼šé‡æ–°è¿›å…¥ Play
1. **å®Œå…¨é€€å‡º Play æ¨¡å¼**
2. é‡æ–°è¿›å…¥ Playï¼ˆç¡®ä¿é‡æ–°ç”Ÿæˆ Entityï¼‰
3. ç‚¹å‡»æ–¹å—

### æ­¥éª¤4ï¼šéªŒè¯æ•ˆæœ
- âœ… æ–¹å—å¼€å§‹è„‰å†²å‘å…‰ï¼ˆé»„è‰²ï¼‰
- âœ… å¼ºåº¦åœ¨ 0.6 ~ 1.0 ä¹‹é—´æ³¢åŠ¨

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·ç‚¹å‡»
    â†“
CubeSelectionManager.SelectCube()
    â†“
è®¾ç½® SelectionState.IsSelected = 1
è®¾ç½® HighlightState.Intensity = 1.2
    â†“
HighlightRenderSystem.OnUpdate()
    â†“
è®¡ç®—è„‰å†²åŠ¨ç”»ï¼ˆsin æ³¢ï¼‰
    â†“
å†™å…¥ URPMaterialPropertyEmissionColor.Value
    â†“
URP æ¸²æŸ“ Emissionï¼ˆå‘å…‰ï¼‰
```

**å…³é”®ç‚¹**ï¼š
- `SelectionState` â†’ æ ‡è®°é€‰ä¸­çŠ¶æ€
- `HighlightState` â†’ å­˜å‚¨å¼ºåº¦ã€é¢œè‰²ã€åŠ¨ç”»æ—¶é—´
- `URPMaterialPropertyEmissionColor` â†’ URP è¯»å–çš„æè´¨å±æ€§
- `HighlightRenderSystem` â†’ è®¡ç®—åŠ¨ç”»å¹¶å†™å…¥æè´¨

---

## ğŸ› å¸¸è§é—®é¢˜

### âŒ ç¼–è¯‘é”™è¯¯ï¼šURPMaterialPropertyEmissionColor ä¸å­˜åœ¨

**åŸå› **ï¼šæ²¡æœ‰å®‰è£… `com.unity.entities.graphics` åŒ…

**è§£å†³**ï¼š
1. `Window > Package Manager`
2. æœç´¢ `Entities Graphics`
3. ç‚¹å‡» `Install`

---

### âŒ ç‚¹å‡»åæ²¡æœ‰ä»»ä½•ååº”

**æ£€æŸ¥**ï¼š
1. Console æœ‰é€‰ä¸­æ—¥å¿—å—ï¼Ÿ
   - æœ‰ â†’ é—®é¢˜åœ¨æ¸²æŸ“
   - æ²¡æœ‰ â†’ é—®é¢˜åœ¨é€‰æ‹©é€»è¾‘ï¼ˆå›åˆ°ä¸Šä¸€æ­¥ï¼‰

2. å®šä¹‰äº†å®å—ï¼Ÿ
   - æ·»åŠ æµ‹è¯•ä»£ç æ£€æŸ¥

3. Entity æœ‰ Emission ç»„ä»¶å—ï¼Ÿ
   - æ·»åŠ è°ƒè¯•ä»£ç æ£€æŸ¥

---

### âŒ æ–¹å—é—ªçƒä¸€ä¸‹å°±æ¶ˆå¤±

**åŸå› **ï¼š`EmissionIntensity` å¤ªä½æˆ–é¢œè‰²å¤ªæš—

**è§£å†³**ï¼š
- `CubeSelectionManager.highlightIntensity` æ”¹ä¸º `2.0f`
- `highlightColor` æ”¹ä¸º `Color.yellow`ï¼ˆæ›´äº®ï¼‰

---

### âŒ æ‰€æœ‰æ–¹å—éƒ½åœ¨å‘å…‰

**åŸå› **ï¼š`CubeLayoutSpawnerAuthoring.EmissionIntensity > 0`

**è§£å†³**ï¼š
- é€‰ä¸­ Spawner Authoring
- `Emission Intensity = 0`ï¼ˆå…³é—­åŸºç¡€å‘å…‰ï¼‰
- åªæœ‰é€‰ä¸­çš„æ–¹å—æ‰ä¼šå‘å…‰

---

## âœ… æˆåŠŸæ ‡å¿—

1. **Console æ—¥å¿—**ï¼š
   ```
   [Selection] é€‰ä¸­ Cubeï¼šEntity=(X:Y), Type=0
   âœ… HAS_URP_MATERIAL_PROPERTY å·²å®šä¹‰
   âœ… Entity æœ‰ Emission ç»„ä»¶
   ```

2. **è§†è§‰æ•ˆæœ**ï¼š
   - æ–¹å—å¼€å§‹è„‰å†²å‘å…‰
   - é»„è‰² Emission
   - å¼ºåº¦å¹³æ»‘å˜åŒ–
   - å³é”®å–æ¶ˆåæ·¡å‡º

3. **Entity Inspector**ï¼ˆWindow > Entities > Hierarchyï¼‰ï¼š
   - `SelectionState.IsSelected = 1`
   - `HighlightState.Intensity > 0`
   - `URPMaterialPropertyEmissionColor` ç»„ä»¶å­˜åœ¨

---

## ğŸ“ è°ƒè¯•æ£€æŸ¥æ¸…å•

è¿è¡Œ Play åï¼Œä¾æ¬¡æ£€æŸ¥ï¼š

- [ ] Console æœ‰ `[Selection] é€‰ä¸­ Cubeï¼š...` æ—¥å¿—
- [ ] Console æœ‰ `âœ… HAS_URP_MATERIAL_PROPERTY å·²å®šä¹‰`
- [ ] Console æœ‰ `âœ… Entity æœ‰ Emission ç»„ä»¶`
- [ ] Cube æè´¨ Shader æ˜¯ `URP/Lit`
- [ ] æè´¨å‹¾é€‰äº† `Emission`
- [ ] `HighlightRenderSystem` åœ¨ Systems çª—å£ä¸­è¿è¡Œ
- [ ] Entity Inspector æ˜¾ç¤º `URPMaterialPropertyEmissionColor` ç»„ä»¶

**å…¨éƒ¨å‹¾é€‰ â†’ å¿…ç„¶å‘å…‰ï¼**

---

## ğŸ¯ ä¸‹ä¸€æ­¥

ç³»ç»Ÿæ­£å¸¸åï¼š

1. **è°ƒæ•´é«˜äº®å‚æ•°**ï¼š
   - `highlightIntensity`ï¼ˆå¼ºåº¦ï¼‰
   - `highlightColor`ï¼ˆé¢œè‰²ï¼‰
   - è„‰å†²é€Ÿåº¦ï¼ˆ`HighlightRenderSystem` ä¸­çš„ `dt * 2f`ï¼‰

2. **æ·»åŠ éŸ³æ•ˆ**ï¼š
   - é€‰ä¸­æ—¶æ’­æ”¾ `click` éŸ³æ•ˆ
   - å–æ¶ˆæ—¶æ’­æ”¾ `deselect` éŸ³æ•ˆ

3. **å®ç°èƒ½åŠ›ç³»ç»Ÿ**ï¼š
   - æ‹‰ä¼¸ï¼ˆExtendï¼‰
   - å¸é™„ï¼ˆAttachï¼‰
   - å½¢çŠ¶è½¬æ¢ï¼ˆShape Shiftï¼‰

---

**æœ€å…³é”®**ï¼šç¡®ä¿å®šä¹‰äº† `HAS_URP_MATERIAL_PROPERTY` å®ï¼æ²¡æœ‰è¿™ä¸ªå®ï¼Œæ‰€æœ‰é«˜äº®ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œã€‚

ç¥è°ƒè¯•æˆåŠŸï¼ğŸ”¥


