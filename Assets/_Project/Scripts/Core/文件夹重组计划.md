# 文件夹重组计划

## 📊 当前问题

### 1. 重复文件
- 很多文件既在根目录又在子文件夹（例如 `CubeLayoutSpawnerAuthoring.cs`）
- 导致混乱和潜在的错误

### 2. 文档混乱
- 20+ 个 .md 文档散落在 Core/ 根目录
- 应该统一移动到 Core/Docs/

### 3. 结构不清晰
- 子文件夹已创建但未完全使用
- 一些文件仍在错误的位置

---

## 🎯 目标结构

```
_Project/Scripts/Core/
│
├── Authoring/                    # MonoBehaviour Authoring 组件
│   ├── Camera/                   # 相机相关
│   │   └── FreeFlyCamera.cs
│   │
│   ├── Layout/                   # 场景布局系统
│   │   ├── CubeLayout.cs
│   │   ├── CubeLayoutSpawnerAuthoring.cs
│   │   ├── CubeLayoutColliderGenerator.cs
│   │   └── CubeLayoutGameObjectSpawner.cs
│   │
│   ├── Selection/                # 选择系统
│   │   ├── CubeSelectionManager.cs
│   │   ├── InteractableProxy.cs
│   │   └── InteractableCubeMarker.cs
│   │
│   ├── Extend/                   # 拉伸系统
│   │   ├── ExtendInputManager.cs
│   │   └── ExtendSettingsAuthoring.cs
│   │
│   ├── Stage/                    # 关卡管理
│   │   ├── StageConfig.cs
│   │   └── StageManager.cs
│   │
│   └── Tools/                    # 开发工具
│       ├── Debug/                # 调试工具
│       │   ├── SelectionDebugTool.cs
│       │   ├── ProxyDiagnosticTool.cs
│       │   └── CubeMaterialChecker.cs
│       │
│       ├── AutoFix/              # 自动修复
│       │   └── SelectionAutoFix.cs
│       │
│       └── Tester/               # 测试工具
│           ├── SelectionTester.cs
│           └── StageManagerTester.cs
│
├── Components/                   # ECS IComponentData
│   ├── Layout/
│   │   ├── LayoutController.cs
│   │   ├── PositionLerp.cs
│   │   └── SpawnIndex.cs
│   │
│   ├── Selection/
│   │   ├── InteractableCubeTag.cs
│   │   ├── SelectionState.cs
│   │   ├── HighlightState.cs
│   │   └── ProxyReference.cs
│   │
│   ├── Extend/
│   │   ├── ExtendableTag.cs
│   │   ├── ExtendPreview.cs
│   │   ├── ExtendSettings.cs
│   │   ├── ExtendChainData.cs
│   │   ├── NeedsCollider.cs
│   │   └── OccupiedCubeMap.cs
│   │
│   ├── Stage/
│   │   └── StageCubeTag.cs
│   │
│   └── Cube/
│       └── CubeTypeTag.cs
│
├── Systems/                      # ECS Systems
│   ├── Layout/
│   │   ├── CubeLayoutSpawnSystem.cs
│   │   ├── LayoutApplySystem.cs
│   │   ├── LayoutToggleSystem.cs
│   │   └── PositionLerpSystem.cs
│   │
│   ├── Selection/
│   │   ├── InteractableProxySpawnSystem.cs
│   │   ├── ProxySyncSystem.cs
│   │   └── HighlightRenderSystem.cs
│   │
│   ├── Extend/
│   │   ├── ExtendPreviewSystem.cs
│   │   ├── ExtendExecutionSystem.cs
│   │   └── OccupiedCubeMapSystem.cs
│   │
│   └── Collider/
│       ├── DynamicColliderSystem.cs
│       └── EntityColliderSyncSystem.cs
│
└── Docs/                         # 所有文档
    ├── QuickStart/               # 快速开始
    │   ├── 选择系统快速入门.md
    │   ├── 拉伸系统快速开始.md
    │   └── 关卡管理系统使用指南.md
    │
    ├── Guides/                   # 使用指南
    │   ├── Cube拉伸系统使用指南.md
    │   ├── Cube选择系统使用指南.md
    │   ├── 标记可交互方块指南.md
    │   └── 输入系统模式切换指南.md
    │
    ├── Technical/                # 技术文档
    │   ├── 拉伸系统技术架构.md
    │   ├── NativeParallelHashMap修复总结.md
    │   └── 空间哈希表并行写入修复说明.md
    │
    ├── Troubleshooting/          # 故障排除
    │   ├── Selection/
    │   │   ├── 选中失效_快速解决方案.md
    │   │   ├── 选中失效问题诊断指南.md
    │   │   ├── 选中失效_修复完成.md
    │   │   └── Proxy无法交互问题修复指南.md
    │   │
    │   ├── Emission/
    │   │   ├── 高亮不发光问题解决.md
    │   │   ├── 所有cube都发光问题解决.md
    │   │   ├── Emission材质正确配置.md
    │   │   └── 发光问题完整排查清单.md
    │   │
    │   └── Testing/
    │       └── 快速测试可交互标记.md
    │
    └── README.md                 # 总索引
```

---

## 📋 执行步骤

### 阶段 1：清理重复文件（删除根目录下的重复）
- [ ] 删除 `Authoring/CubeLayout.cs`（保留 `Authoring/Layout/` 中的）
- [ ] 删除 `Authoring/CubeLayoutSpawnerAuthoring.cs`
- [ ] 删除 `Authoring/CubeLayoutColliderGenerator.cs`
- [ ] 删除 `Authoring/CubeLayoutGameObjectSpawner.cs`
- [ ] 删除 `Authoring/ExtendInputManager.cs`（保留 `Authoring/Extend/` 中的）
- [ ] 删除 `Authoring/CubeSelectionManager.cs`（保留 `Authoring/Selection/` 中的）
- [ ] 删除 `Authoring/InteractableProxy.cs`
- [ ] 删除 `Authoring/InteractableCubeMarker.cs`
- [ ] 删除 `Authoring/StageConfig.cs`（保留 `Authoring/Stage/` 中的）
- [ ] 删除 `Authoring/StageManager.cs`

### 阶段 2：移动工具到 Tools/ 子文件夹
- [x] `SelectionDebugTool.cs` → `Tools/Debug/`（已完成）
- [x] `SelectionAutoFix.cs` → `Tools/AutoFix/`（已完成）
- [x] `ProxyDiagnosticTool.cs` → `Tools/Debug/`（已完成）
- [x] `CubeMaterialChecker.cs` → `Tools/Debug/`（已完成）
- [x] `SelectionTester.cs` → `Tools/Tester/`（已完成）
- [x] `StageManagerTester.cs` → `Tools/Tester/`（已完成）

### 阶段 3：清理 Components/ 重复文件
- [ ] 删除 `Components/CubeTypeTag.cs`（保留 `Components/Cube/` 中的）
- [ ] 删除 `Components/ExtendableTag.cs`（保留 `Components/Extend/` 中的）
- [ ] 删除 `Components/ExtendChainData.cs`
- [ ] 删除 `Components/ExtendPreview.cs`
- [ ] 删除 `Components/ExtendSettings.cs`
- [ ] 删除 `Components/HighlightState.cs`（保留 `Components/Selection/` 中的）
- [ ] 删除 `Components/InteractableCubeTag.cs`
- [ ] 删除 `Components/NeedsCollider.cs`
- [ ] 删除 `Components/OccupiedCubeMap.cs`
- [ ] 删除 `Components/ProxyReference.cs`
- [ ] 删除 `Components/SelectionState.cs`
- [ ] 删除 `Components/StageCubeTag.cs`

### 阶段 4：清理 Systems/ 重复文件
- [ ] 删除 `Systems/CubeLayoutSpawnSystem.cs`（保留 `Systems/Layout/` 中的）
- [ ] 删除 `Systems/LayoutApplySystem.cs`
- [ ] 删除 `Systems/LayoutToggleSystem.cs`
- [ ] 删除 `Systems/ExtendExecutionSystem.cs`（保留 `Systems/Extend/` 中的）
- [ ] 删除 `Systems/ExtendPreviewSystem.cs`
- [ ] 删除 `Systems/OccupiedCubeMapSystem.cs`
- [ ] 删除 `Systems/HighlightRenderSystem.cs`（保留 `Systems/Selection/` 中的）
- [ ] 删除 `Systems/InteractableProxySpawnSystem.cs`
- [ ] 删除 `Systems/ProxySyncSystem.cs`
- [ ] 删除 `Systems/DynamicColliderSystem.cs`（保留 `Systems/Collider/` 中的）
- [ ] 删除 `Systems/EntityColliderSyncSystem.cs`

### 阶段 5：整理文档到 Docs/
- [ ] 移动所有 .md 文件到 `Docs/` 的相应子文件夹
- [ ] 创建 `Docs/README.md` 索引文件
- [ ] 更新文档内的相对路径引用

---

## ⚠️ 注意事项

### 删除文件前检查
1. **确认子文件夹中有副本**
2. **检查是否有其他脚本引用**
3. **最好先做 Git Commit**

### Unity 刷新
- 删除文件后，Unity 会自动删除 .meta 文件
- 可能需要等待编译完成

### 引用更新
- 某些脚本可能有 namespace 引用
- 删除后可能需要修复编译错误

---

## ✅ 验证清单

### 编译检查
- [ ] 无编译错误
- [ ] 无缺失引用警告
- [ ] 所有 System 正常运行

### 功能测试
- [ ] 场景生成正常
- [ ] 选择系统正常
- [ ] 拉伸系统正常
- [ ] 关卡切换正常

### 文档检查
- [ ] 所有文档可访问
- [ ] 文档内链接有效
- [ ] README.md 索引完整

---

## 🎯 预期结果

### 代码结构
- ✅ 无重复文件
- ✅ 文件夹层次清晰
- ✅ 命名一致性
- ✅ 功能分组合理

### 文档结构
- ✅ 所有文档在 Docs/ 下
- ✅ 分类清晰（快速开始/指南/技术/故障排除）
- ✅ 易于查找

### 开发体验
- ✅ 文件易于定位
- ✅ 结构易于理解
- ✅ 便于扩展维护

---

**创建时间**：2025-10-24  
**状态**：📝 计划中  
**预计耗时**：15-20 分钟

